<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <hta:application
        applicationname="Termo de Cessão de Equipamentos"
        border="thin"
        borderstyle="normal"
        caption="yes"
        showintaskbar="yes"
        singleinstance="yes"
        sysmenu="yes"
        windowstate="normal"
    />
    <title>Termo de Cessão de Equipamentos</title>
    <style>
        /* Estilos para impressão */
        @media print {
            @page {
                size: A4 portrait;
                margin: 10mm; /* Margens reduzidas ao máximo */
            }
            .email-button {
                display: none;
            }
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            box-sizing: border-box;
        }

        .container {
            width: 210mm; /* Largura de uma folha A4 */
            height: 297mm; /* Altura de uma folha A4 */
            margin: auto;
            background: white;
            padding: 10mm; /* Margens internas reduzidas */
            box-sizing: border-box;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Distribui o conteúdo verticalmente */
        }

        h1 {
            text-align: center;
            font-size: 24px; /* Tamanho maior para ocupar espaço */
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .logo {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }

        .logo img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        h2 {
            font-size: 20px; /* Tamanho maior para ocupar espaço */
            margin-bottom: 8px;
            text-align: center;
            text-transform: uppercase;
        }

        hr {
            border: 1px solid #ccc;
            margin: 8px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 8px;
            flex-grow: 1; /* Expande a tabela para ocupar espaço disponível */
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th, td {
            padding: 8px; /* Padding padrão */
            text-align: left;
            font-size: 16px; /* Tamanho maior para ocupar espaço */
        }

        th {
            background-color: #004d00;
            color: white;
            font-weight: bold;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .footer-table {
            width: 100%;
            margin-top: 8px;
            border-collapse: collapse;
        }

        .footer-table th, .footer-table td {
            border: 1px solid #ccc;
            padding: 8px; /* Padding padrão */
            font-size: 16px; /* Tamanho maior para ocupar espaço */
            text-align: left;
        }

        .footer-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .footer-table td {
            vertical-align: top;
        }

        .email-button {
            background-color: #007bff;
            color: white;
            text-align: center;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .email-button a {
            color: white;
            text-decoration: none;
        }

        .email-button:hover {
            background-color: #0056b3;
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .signature-section {
            margin-top: 10px;
            font-size: 16px; /* Tamanho maior para ocupar espaço */
            flex-grow: 1; /* Expande o texto para ocupar espaço disponível */
        }

        .signature-section p {
            margin: 8px 0;
        }

        .internal-info {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            font-size: 18px; /* Tamanho maior para ocupar espaço */
        }

        .internal-info span {
            display: block;
            margin-top: 4px;
            font-weight: normal;
        }

        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
            text-align: center;
        }

        #loadingLogo {
            width: 150px;
            animation: spin 6s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        #loadingText {
            margin-top: 20px;
            color: #ffffff;
            font-size: 18px;
        }

        #progressBar {
            width: 80%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            margin-top: 20px;
            overflow: hidden;
        }

        #progress {
            height: 100%;
            width: 0;
            background-color: #28a745;
            transition: width 0.3s;
        }

        #percentage {
            font-size: 20px;
            color: #ffffff;
            margin-top: 10px;
        }

        #successMessage {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #007bff;
            font-size: 20px;
            text-align: center;
            z-index: 10000;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        #successLogo {
            max-width: 100px;
            margin-bottom: 10px;
        }

        .user-info {
            text-align: right;
            font-size: 16px; /* Tamanho maior para ocupar espaço */
            margin-bottom: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="user-info">
        Usuário logado: <span id="loggedUser">Carregando...</span>
    </div>
    
    <div class="container" id="content">
        <div class="logo">
            <img src="/img/Cabeçalho.png" alt="Cabeçalho">
        </div>

        <div class="signature-section">
          <h4>  Usuário:  <strong><%= usuario %></strong> <br>
            Por este instrumento particular eu, <strong><%= nome %></strong>, portador do RG nº <strong><%= rg %></strong>,
            <% if (tipoUsuario === "Colaborador") { %>
                inscrito no CPF nº <strong><%= cpf %></strong>, <strong><%= tipoUsuario %></strong> do setor de <strong><%= setor %></strong> da unidade de negócio <strong><%= unidade %></strong>,
            <% } else if (tipoUsuario === "Prestador de Serviços") { %>
                inscrito no CNPJ nº <strong><%= cnpj %></strong>, <strong>Prestador de Serviços Administrativos da área de <%= setor %></strong>,
            <% } %> 
            recebo da ?. nesta data <strong><%= dataAtual %></strong>, os equipamentos e periféricos listados abaixo, cuja posse passo a ter em caráter temporário.
        </div>

        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Descrição</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Série</th>
                    <th>NF de referência</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="equipmentTableBody">
                <!-- Linhas serão inseridas dinamicamente aqui -->
            </tbody>
        </table>

        <div id="returnDeclarationContainer">
            <!-- Tabela de devolução será inserida dinamicamente aqui -->
        </div>
        
        <div class="signature-section">
           <h4> Declaro ter ciência e estar de acordo com os procedimentos descritos na Política PL.GC.035 Entrega, Uso e Devolução de Equipamentos de TI e Periféricos, emitida e divulgada pela Gramado Parks, comprometendo-me a respeitá-las, cumprindo e aceitando-as plenamente, bem como o disposto abaixo:
            Estou ciente de que o equipamento fornecido é de propriedade da empresa que o forneceu; portanto, será utilizado por mim única e exclusivamente a título de empréstimo para o melhor desempenho e execução das atividades para as quais fui contratado, não tendo em hipótese alguma conotação de uso pessoal. 
            Devo utilizá-lo com cuidado, guardá-lo em local seguro, além de garantir a utilização adequada das ferramentas de criptografia, antivírus e proteção, visando assegurar que as informações nele contidas não sejam divulgadas, nem tenham destinação diversa dos objetivos da Companhia, responsabilizando-me civilmente pela eventual divulgação indevida destas informações, nos termos da lei.
            Se os equipamentos forem danificados ou inutilizados por emprego inadequado, mau uso, negligência ou extravio, deverei comunicar imediatamente a área competente. A Companhia me fornecerá novos equipamentos e cobrará o valor dos equipamentos da mesma marca ou equivalentes.
            Devo utilizar somente os softwares instalados e homologados pela área de Tecnologia da Informação (TI) da Gramado Parks, não removendo, alterando ou acrescentando, sem autorização expressa desta, qualquer tipo de dispositivo periférico ou software neste equipamento. Todos os softwares contidos neste são devidamente licenciados e é proibida a sua distribuição ou cópia sem prévia autorização. Qualquer outro software que venha a ser necessário para o exercício de minhas atividades deve ser aprovado e instalado pela área de TI.
            São expressamente proibidos a: criação, download, guarda ou veiculação de material de cunho pornográfico e/ou imoral, discriminatório, ofensivo, contra a ética e os bons costumes, no equipamento fornecido.
            Diante do exposto acima, reconheço que a Companhia, dentro de suas atribuições independentemente de aviso, está autorizada a:
            monitorar, registrar e analisar todas as aplicações e dados localizados no equipamento que foram acessados através de minha senha;
            modificar e/ou bloquear os acessos sempre que houver necessidade e a critério desta;
            verificar todos os arquivos contidos no equipamento a qualquer momento.
            Estou ciente que este termo terá validade a partir de sua assinatura e permanecerá válido enquanto meu contrato com a Gramado Parks estiver vigente.
            O descumprimento das obrigações assumidas neste compromisso caracterizará grave infração, resultando em ações disciplinares aplicáveis, como medidas administrativas e/ou disciplinares no âmbito da Companhia, sujeitando-me à reparação pelos danos causados, sendo facultado à Companha a adoção de medidas pertinentes, incluindo as de natureza indenizatória, em valor equivalente ou substituição (idêntico ou similar). 
            Reconheço que em caso de desligamento ou rescisão de contrato devo devolver o equipamento para o líder da área em que atuo/ presto serviço no prazo em até 1 (um) dia. Saliento que fui informado que caso o equipamento não seja entregue neste prazo, o valor do equipamento na data de desligamento/ rescisão será descontado das minhas verbas rescisórias ou da NF em caso de Prestador de Serviços.
        </div>

        <div class="internal-info">
            INTERNO
            <span>As informações contidas nesse documento são de uso interno</span>
        </div>

        <p class="auto-doc">AutoDoc termo gerado por sistema automatizado by Gramado Parks.</p>
    </div>

    <button class="email-button" onclick="sendEmail()">
        Chegamos ao final, é hora de enviar os documentos por e-mail clicando aqui
    </button>

    <div id="loadingScreen">
        <img src="/LogoEfeito.png" alt="Logo girando" id="loadingLogo">
        <div id="loadingText">Estamos enviando os documentos...</div>
        <div id="progressBar">
            <div id="progress"></div>
        </div>
        <div id="percentage">0%</div>
    </div>

    <div id="successMessage">
        Muito bem, termos enviados com sucesso para a empresa e uma cópia para seu e-mail corporativo.<br>By Gramado Parks
    </div>

    <script>
        window.addEventListener('load', function () {
            loadDataFromTxt();
            loadLoggedUser();
        });

        function loadLoggedUser() {
            fetch('/getLoggedUser')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loggedUser').textContent = data.loggedUser;
                })
                .catch(error => {
                    console.error('Erro ao carregar o nome do usuário logado:', error);
                    document.getElementById('loggedUser').textContent = 'Erro ao carregar o usuário';
                });
        }

        function sendEmail() {
            document.getElementById('loadingScreen').style.display = 'flex';

            let progress = 0;
            const progressElement = document.getElementById('progress');
            const percentageElement = document.getElementById('percentage');

            function updateProgress() {
                if (progress < 100) {
                    progress += 1;
                    progressElement.style.width = progress + '%';
                    percentageElement.textContent = progress + '%';
                    setTimeout(updateProgress, 50);
                } else {
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'block';
                    }, 500);
                }
            }

            updateProgress();

            fetch('/execute-batch', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        console.log('Batch file executed successfully.');
                        window.location.href = "mailto:exemplo@dominio.com";
                    }
                })
                .catch(error => {
                    console.error('Erro ao executar o batch:', error);
                });
        }

        function loadDataFromTxt() {
            fetch('/getPCInfo')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    populateTable(data);
                    generateReturnDeclarationTable(data);
                })
                .catch(error => {
                    console.error('Erro ao carregar o arquivo:', error);
                });
        }

        function populateTable(data) {
            const tableBody = document.getElementById('equipmentTableBody');
            tableBody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');

                const itemCell = document.createElement('td');
                itemCell.textContent = index + 1;

                const descriptiveCell = document.createElement('td');
                descriptiveCell.textContent = item.descriptive || 'Desconhecido';

                const brandCell = document.createElement('td');
                brandCell.textContent = item.brand || 'Desconhecido';

                const modelCell = document.createElement('td');
                modelCell.textContent = item.model || 'Desconhecido';

                const serialCell = document.createElement('td');
                serialCell.textContent = item.serial || 'Desconhecido';

                const NotaFiscalCell = document.createElement('td');
                NotaFiscalCell.textContent = item.observation || 'X';

                const ValorCell = document.createElement('td');
                ValorCell.textContent = item.observation || 'X';

                row.appendChild(itemCell);
                row.appendChild(descriptiveCell);
                row.appendChild(brandCell);
                row.appendChild(modelCell);
                row.appendChild(serialCell);
                row.appendChild(NotaFiscalCell);
                row.appendChild(ValorCell);

                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>